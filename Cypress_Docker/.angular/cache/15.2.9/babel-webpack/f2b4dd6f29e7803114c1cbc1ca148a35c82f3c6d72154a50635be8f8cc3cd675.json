{"ast":null,"code":"import { BehaviorSubject } from \"rxjs\";\nimport { map, distinctUntilChanged, tap, shareReplay } from \"rxjs/operators\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./jwt.service\";\nimport * as i3 from \"@angular/router\";\nexport class UserService {\n  constructor(http, jwtService, router) {\n    this.http = http;\n    this.jwtService = jwtService;\n    this.router = router;\n    this.currentUserSubject = new BehaviorSubject(null);\n    this.currentUser = this.currentUserSubject.asObservable().pipe(distinctUntilChanged());\n    this.isAuthenticated = this.currentUser.pipe(map(user => !!user));\n  }\n  login(credentials) {\n    return this.http.post(\"/users/login\", {\n      user: credentials\n    }).pipe(tap(({\n      user\n    }) => this.setAuth(user)));\n  }\n  register(credentials) {\n    return this.http.post(\"/users\", {\n      user: credentials\n    }).pipe(tap(({\n      user\n    }) => this.setAuth(user)));\n  }\n  logout() {\n    this.purgeAuth();\n    void this.router.navigate([\"/\"]);\n  }\n  getCurrentUser() {\n    return this.http.get(\"/user\").pipe(tap({\n      next: ({\n        user\n      }) => this.setAuth(user),\n      error: () => this.purgeAuth()\n    }), shareReplay(1));\n  }\n  update(user) {\n    return this.http.put(\"/user\", {\n      user\n    }).pipe(tap(({\n      user\n    }) => {\n      this.currentUserSubject.next(user);\n    }));\n  }\n  setAuth(user) {\n    this.jwtService.saveToken(user.token);\n    this.currentUserSubject.next(user);\n  }\n  purgeAuth() {\n    this.jwtService.destroyToken();\n    this.currentUserSubject.next(null);\n  }\n  static #_ = this.ɵfac = function UserService_Factory(t) {\n    return new (t || UserService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.JwtService), i0.ɵɵinject(i3.Router));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: UserService,\n    factory: UserService.ɵfac,\n    providedIn: \"root\"\n  });\n}","map":{"version":3,"mappings":"AACA,SAAqBA,eAAe,QAAQ,MAAM;AAGlD,SAASC,GAAG,EAAEC,oBAAoB,EAAEC,GAAG,EAAEC,WAAW,QAAQ,gBAAgB;;;;;AAM5E,OAAM,MAAOC,WAAW;EAQtBC,YACmBC,IAAgB,EAChBC,UAAsB,EACtBC,MAAc;IAFd,SAAI,GAAJF,IAAI;IACJ,eAAU,GAAVC,UAAU;IACV,WAAM,GAANC,MAAM;IAVjB,uBAAkB,GAAG,IAAIT,eAAe,CAAc,IAAI,CAAC;IAC5D,gBAAW,GAAG,IAAI,CAACU,kBAAkB,CACzCC,YAAY,EAAE,CACdC,IAAI,CAACV,oBAAoB,EAAE,CAAC;IAExB,oBAAe,GAAG,IAAI,CAACW,WAAW,CAACD,IAAI,CAACX,GAAG,CAAEa,IAAI,IAAK,CAAC,CAACA,IAAI,CAAC,CAAC;EAMlE;EAEHC,KAAK,CAACC,WAGL;IACC,OAAO,IAAI,CAACT,IAAI,CACbU,IAAI,CAAiB,cAAc,EAAE;MAAEH,IAAI,EAAEE;IAAW,CAAE,CAAC,CAC3DJ,IAAI,CAACT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC,CAAC,CAAC;EAChD;EAEAK,QAAQ,CAACH,WAIR;IACC,OAAO,IAAI,CAACT,IAAI,CACbU,IAAI,CAAiB,QAAQ,EAAE;MAAEH,IAAI,EAAEE;IAAW,CAAE,CAAC,CACrDJ,IAAI,CAACT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC,CAAC,CAAC;EAChD;EAEAM,MAAM;IACJ,IAAI,CAACC,SAAS,EAAE;IAChB,KAAK,IAAI,CAACZ,MAAM,CAACa,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC;EAClC;EAEAC,cAAc;IACZ,OAAO,IAAI,CAAChB,IAAI,CAACiB,GAAG,CAAiB,OAAO,CAAC,CAACZ,IAAI,CAChDT,GAAG,CAAC;MACFsB,IAAI,EAAE,CAAC;QAAEX;MAAI,CAAE,KAAK,IAAI,CAACI,OAAO,CAACJ,IAAI,CAAC;MACtCY,KAAK,EAAE,MAAM,IAAI,CAACL,SAAS;KAC5B,CAAC,EACFjB,WAAW,CAAC,CAAC,CAAC,CACf;EACH;EAEAuB,MAAM,CAACb,IAAmB;IACxB,OAAO,IAAI,CAACP,IAAI,CAACqB,GAAG,CAAiB,OAAO,EAAE;MAAEd;IAAI,CAAE,CAAC,CAACF,IAAI,CAC1DT,GAAG,CAAC,CAAC;MAAEW;IAAI,CAAE,KAAI;MACf,IAAI,CAACJ,kBAAkB,CAACe,IAAI,CAACX,IAAI,CAAC;IACpC,CAAC,CAAC,CACH;EACH;EAEAI,OAAO,CAACJ,IAAU;IAChB,IAAI,CAACN,UAAU,CAACqB,SAAS,CAACf,IAAI,CAACgB,KAAK,CAAC;IACrC,IAAI,CAACpB,kBAAkB,CAACe,IAAI,CAACX,IAAI,CAAC;EACpC;EAEAO,SAAS;IACP,IAAI,CAACb,UAAU,CAACuB,YAAY,EAAE;IAC9B,IAAI,CAACrB,kBAAkB,CAACe,IAAI,CAAC,IAAI,CAAC;EACpC;EAAC;qBAhEUpB,WAAW;EAAA;EAAA;WAAXA,WAAW;IAAA2B,SAAX3B,WAAW;IAAA4B,YADE;EAAM","names":["BehaviorSubject","map","distinctUntilChanged","tap","shareReplay","UserService","constructor","http","jwtService","router","currentUserSubject","asObservable","pipe","currentUser","user","login","credentials","post","setAuth","register","logout","purgeAuth","navigate","getCurrentUser","get","next","error","update","put","saveToken","token","destroyToken","factory","providedIn"],"sourceRoot":"","sources":["C:\\Progetti\\Test\\angular-realworld-example-app-docker\\src\\app\\core\\services\\user.service.ts"],"sourcesContent":["import { Injectable } from \"@angular/core\";\r\nimport { Observable, BehaviorSubject } from \"rxjs\";\r\n\r\nimport { JwtService } from \"./jwt.service\";\r\nimport { map, distinctUntilChanged, tap, shareReplay } from \"rxjs/operators\";\r\nimport { HttpClient } from \"@angular/common/http\";\r\nimport { User } from \"../models/user.model\";\r\nimport { Router } from \"@angular/router\";\r\n\r\n@Injectable({ providedIn: \"root\" })\r\nexport class UserService {\r\n  private currentUserSubject = new BehaviorSubject<User | null>(null);\r\n  public currentUser = this.currentUserSubject\r\n    .asObservable()\r\n    .pipe(distinctUntilChanged());\r\n\r\n  public isAuthenticated = this.currentUser.pipe(map((user) => !!user));\r\n\r\n  constructor(\r\n    private readonly http: HttpClient,\r\n    private readonly jwtService: JwtService,\r\n    private readonly router: Router\r\n  ) {}\r\n\r\n  login(credentials: {\r\n    email: string;\r\n    password: string;\r\n  }): Observable<{ user: User }> {\r\n    return this.http\r\n      .post<{ user: User }>(\"/users/login\", { user: credentials })\r\n      .pipe(tap(({ user }) => this.setAuth(user)));\r\n  }\r\n\r\n  register(credentials: {\r\n    username: string;\r\n    email: string;\r\n    password: string;\r\n  }): Observable<{ user: User }> {\r\n    return this.http\r\n      .post<{ user: User }>(\"/users\", { user: credentials })\r\n      .pipe(tap(({ user }) => this.setAuth(user)));\r\n  }\r\n\r\n  logout(): void {\r\n    this.purgeAuth();\r\n    void this.router.navigate([\"/\"]);\r\n  }\r\n\r\n  getCurrentUser(): Observable<{ user: User }> {\r\n    return this.http.get<{ user: User }>(\"/user\").pipe(\r\n      tap({\r\n        next: ({ user }) => this.setAuth(user),\r\n        error: () => this.purgeAuth(),\r\n      }),\r\n      shareReplay(1)\r\n    );\r\n  }\r\n\r\n  update(user: Partial<User>): Observable<{ user: User }> {\r\n    return this.http.put<{ user: User }>(\"/user\", { user }).pipe(\r\n      tap(({ user }) => {\r\n        this.currentUserSubject.next(user);\r\n      })\r\n    );\r\n  }\r\n\r\n  setAuth(user: User): void {\r\n    this.jwtService.saveToken(user.token);\r\n    this.currentUserSubject.next(user);\r\n  }\r\n\r\n  purgeAuth(): void {\r\n    this.jwtService.destroyToken();\r\n    this.currentUserSubject.next(null);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}